import{_ as i,r as t,o as l,c as o,b as e,d as n,e as s,a as p}from"./app-ZxN7btYB.js";const r={},c=e("h1",{id:"container-images",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#container-images"},[e("span",null,"Container Images")])],-1),d=e("h2",{id:"base-images-on-openshift",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#base-images-on-openshift"},[e("span",null,"Base Images on OpenShift")])],-1),m={class:"custom-container tip"},u=e("p",{class:"custom-container-title"},"TIP",-1),g=e("p",null,"Updating base images on OpenShift is only done at the specific Build config;",-1),h={href:"https://github.com/bcgov/gdx-agreements-tracker/blob/development/deployments/kustomize/image-builds/nodejs-s2i.yaml#L29",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/bcgov/gdx-agreements-tracker/blob/development/deployments/kustomize/image-builds/nginx.yaml#L27",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/bcgov/gdx-agreements-tracker/blob/development/deployments/kustomize/image-builds/postgres.yaml#L31",target:"_blank",rel:"noopener noreferrer"},k=p(`<h3 id="updating-openshift-build-configs" tabindex="-1"><a class="header-anchor" href="#updating-openshift-build-configs"><span>Updating OpenShift Build Configs</span></a></h3><p>After the images have been updated into the Build Configs for Node, Nginx and Postgres, update the build configs by running the following commands.</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Step 1 - Go to Directory of Repo</span>
<span class="token builtin class-name">cd</span> gdx-agreements-tracker
<span class="token comment"># Step 2 - Login to OpenShift oc command line</span>
oc login <span class="token parameter variable">--token</span><span class="token operator">=</span>secret-token <span class="token parameter variable">--server</span><span class="token operator">=</span>https://myopnshift.com
<span class="token comment"># Step 3 - Choose the tools folder</span>
oc project <span class="token number">12345</span>-tools
<span class="token comment"># step 4 - Apply kustomize file</span>
oc apply <span class="token parameter variable">-k</span> deployments/kustomize/image-builds
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Don&#39;t forget this step, otherwise base images will never get updated.</p></div><h3 id="s2i-node-base-image" tabindex="-1"><a class="header-anchor" href="#s2i-node-base-image"><span>S2I Node Base Image</span></a></h3><div class="language-yaml" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>        <span class="token key atrule">name</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span>18.18<span class="token punctuation">-</span>alpine3.18
</code></pre></div><h3 id="s2i-nginx-base-image" tabindex="-1"><a class="header-anchor" href="#s2i-nginx-base-image"><span>S2I Nginx Base Image</span></a></h3><div class="language-yaml" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.25.3
</code></pre></div><h3 id="postgres-base-image" tabindex="-1"><a class="header-anchor" href="#postgres-base-image"><span>Postgres Base Image</span></a></h3><div class="language-yaml" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>        <span class="token key atrule">name</span><span class="token punctuation">:</span> postgres<span class="token punctuation">:</span>15.5<span class="token punctuation">-</span>bullseye
</code></pre></div><h2 id="building-images-locally-using-docker" tabindex="-1"><a class="header-anchor" href="#building-images-locally-using-docker"><span>Building Images Locally using Docker</span></a></h2><p>Local development only uses docker for the database, and the app, and api use node on the local machine. The images builds for the app, and api utilizes the OpenShift s2i, therefor these image builds might only be useful for troubleshooting.</p><h3 id="nodejs" tabindex="-1"><a class="header-anchor" href="#nodejs"><span>NodeJs</span></a></h3><p>Is used for building both the api and frontend application.</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Build</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> node-s2i <span class="token punctuation">\\</span>
<span class="token parameter variable">-f</span> openshift/templates/images/nodejs/Dockerfile <span class="token punctuation">\\</span>
./openshift/templates/images/nodejs/
<span class="token comment"># Verify</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> node-s2i /usr/local/s2i/usage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nginx" tabindex="-1"><a class="header-anchor" href="#nginx"><span>Nginx</span></a></h3><p>Is required for building application, creates Nginx server.</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Build</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> nginx-s2i <span class="token punctuation">\\</span>
<span class="token parameter variable">-f</span> openshift/templates/images/nginx/docker/Dockerfile <span class="token punctuation">\\</span>
./openshift/templates/images/nginx/docker/
<span class="token comment"># Verify</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> nginx-s2i <span class="token function">cat</span> /etc/nginx/conf.d/default.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="postgres" tabindex="-1"><a class="header-anchor" href="#postgres"><span>Postgres</span></a></h3><p>The PostgreSQL database image</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Build</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> postgres-run <span class="token punctuation">\\</span>
<span class="token parameter variable">-f</span> openshift/templates/images/postgres/Dockerfile <span class="token punctuation">\\</span>
./openshift/templates/images/postgres/
<span class="token comment"># Verify</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> postgres-run <span class="token function">env</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="application" tabindex="-1"><a class="header-anchor" href="#application"><span>Application</span></a></h3><p>The frontend application, however the build is failing on docker, but works with OpenShift</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Build</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> app-run <span class="token punctuation">\\</span>
<span class="token parameter variable">-f</span> ./frontend/Dockerfile <span class="token punctuation">\\</span>
./frontend/
<span class="token comment"># Verify</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> app-run <span class="token parameter variable">-p</span> <span class="token number">308080</span>:8080
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="api" tabindex="-1"><a class="header-anchor" href="#api"><span>API</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># TBD</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,26);function f(x,y){const a=t("ExternalLinkIcon");return l(),o("div",null,[c,d,e("div",m,[u,g,e("ul",null,[e("li",null,[e("a",h,[n("s2i Node"),s(a)])]),e("li",null,[e("a",b,[n("s2i Nginx"),s(a)])]),e("li",null,[e("a",v,[n("Postgres"),s(a)])])])]),k])}const B=i(r,[["render",f],["__file","building_images.html.vue"]]),I=JSON.parse('{"path":"/guide/GettingStarted/building_images.html","title":"Container Images","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Base Images on OpenShift","slug":"base-images-on-openshift","link":"#base-images-on-openshift","children":[{"level":3,"title":"Updating OpenShift Build Configs","slug":"updating-openshift-build-configs","link":"#updating-openshift-build-configs","children":[]},{"level":3,"title":"S2I Node Base Image","slug":"s2i-node-base-image","link":"#s2i-node-base-image","children":[]},{"level":3,"title":"S2I Nginx Base  Image","slug":"s2i-nginx-base-image","link":"#s2i-nginx-base-image","children":[]},{"level":3,"title":"Postgres Base Image","slug":"postgres-base-image","link":"#postgres-base-image","children":[]}]},{"level":2,"title":"Building Images Locally using Docker","slug":"building-images-locally-using-docker","link":"#building-images-locally-using-docker","children":[{"level":3,"title":"NodeJs","slug":"nodejs","link":"#nodejs","children":[]},{"level":3,"title":"Nginx","slug":"nginx","link":"#nginx","children":[]},{"level":3,"title":"Postgres","slug":"postgres","link":"#postgres","children":[]},{"level":3,"title":"Application","slug":"application","link":"#application","children":[]},{"level":3,"title":"API","slug":"api","link":"#api","children":[]}]}],"git":{"contributors":[{"name":"ASpiteri-BCGov","email":"49036255+ASpiteri-BCGov@users.noreply.github.com","commits":1}]},"filePathRelative":"guide/GettingStarted/building_images.md"}');export{B as comp,I as data};
